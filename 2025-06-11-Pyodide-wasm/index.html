<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Pyodide-CodeMirror5-python</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.13/lib/codemirror.css" />
  <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.13/lib/codemirror.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.13/mode/python/python.js"></script>
  <style>
    .CodeMirror {
      height: 300px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
  </style>
</head>
<body>

<h2>ğŸ§ª Pyodide åœ¨çº¿ Python Demo, ä½¿ç”¨ CodeMirror 5 ä½œä¸ºä»£ç ç¼–è¾‘å™¨</h2>

<textarea id="code" name="code">
print("Hello from Pyodide!")
for i in range(5):
    print("Number", i)
</textarea>

<button id="runBtn">è¿è¡Œä»£ç </button>

<pre id="output" style="background:#000; color:#0f0; padding:10px; height:300px; overflow:auto;"></pre>

<script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
<script>
  // åˆå§‹åŒ– CodeMirror ç¼–è¾‘å™¨
  const editor = CodeMirror.fromTextArea(document.getElementById('code'), {
    mode: 'python',
    lineNumbers: true,
    indentUnit: 4,
    tabSize: 4,
    indentWithTabs: false,
  });

  let pyodideReadyPromise = loadPyodide();
  const runBtn = document.getElementById('runBtn');
  const outputEl = document.getElementById('output');

  runBtn.onclick = async () => {
    outputEl.textContent = 'â³ åŠ è½½ Pyodide å¹¶è¿è¡Œä»£ç ...';
    const pyodide = await pyodideReadyPromise;

    try {
      outputEl.textContent = ''; // æ¸…ç©ºè¾“å‡º
      pyodide.setStdout({
        batched: (s) => { outputEl.textContent += s + '\n'; }
      });
      pyodide.setStderr({
        batched: (s) => { outputEl.textContent += s + '\n'; }
      });
      await pyodide.runPythonAsync(editor.getValue());
    } catch (err) {
      outputEl.textContent = 'âŒ é”™è¯¯:\n' + err;
    }
  };
</script>

</body>
</html>
